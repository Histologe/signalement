const sortTableFunction=e=>function(t){"a"==t.target.tagName.toLowerCase()&&(sortRows(e,siblingIndex(t.target.parentNode)),t.preventDefault())},siblingIndex=e=>{let t=0;for(;e=e.previousElementSibling;)t++;return t},sortRows=(e,t)=>{let r,a,o,n=e.querySelectorAll("tbody tr"),l="thead th:nth-child("+(t+1)+")",i="td:nth-child("+(t+1)+")",d=e.querySelector(l).classList,c=[],u="",s=!0;for(d&&(d.contains("date")?u="date":d.contains("number")&&(u="number")),a=0;a<n.length;a++)o=n[a].querySelector(i),r=o.innerText,isNaN(r)?s=!1:r=parseFloat(r),c.push({value:r,row:n[a]});""==u&&s&&(u="number"),"number"==u?(c.sort(sortNumberVal),c=c.reverse()):"date"==u?c.sort(sortDateVal):c.sort(sortTextVal);for(let t=0;t<c.length;t++)e.querySelector("tbody").appendChild(c[t].row)},sortNumberVal=(e,t)=>sortNumber(e.value,t.value),sortNumber=(e,t)=>e-t,sortDateVal=(e,t)=>{let r=Date.parse(e.value),a=Date.parse(t.value);return sortNumber(r,a)},sortTextVal=(e,t)=>{let r=(e.value+"").toUpperCase(),a=(t.value+"").toUpperCase();return r<a?-1:r>a?1:0};let invalid,table,thead,headers,i,j,tables=document.querySelectorAll("table.sortable");for(i=0;i<tables.length;i++)if(table=tables[i],thead=table.querySelector("thead")){for(headers=thead.querySelectorAll("th"),j=0;j<headers.length;j++)headers[j].innerHTML="<a href='#'>"+headers[j].innerText+"</a>";thead.addEventListener("click",sortTableFunction(table))}document?.querySelectorAll(".fr-pagination__link:not([aria-current])").forEach((e=>{let t,r,a,o=document.querySelector(".fr-pagination__link--prev"),n=document.querySelector(".fr-pagination__link--next"),l=document.querySelector(".fr-pagination__link--first"),i=document.querySelector(".fr-pagination__link--last"),d=1,c=parseInt(i.getAttribute("data-page"));e.addEventListener("click",(e=>{let u=new FormData;u.append("pagination","true"),u.append("search",document.querySelector("#header-search-input").value),u.append("status",document.querySelector("#filter_statut").value),u.append("ville",document.querySelector("#filter_ville").value);let s=document?.querySelector(".fr-pagination__link[aria-current]"),m=e.target;m!==o&&m!==n&&m!==l&&m!==i?d=parseInt(m.getAttribute("data-page")):m===n?d=parseInt(s.getAttribute("data-page"))+1:m===o?d=parseInt(s.getAttribute("data-page"))-1:m===i?d=parseInt(c):m===l&&(d=parseInt(1)),u.append("page",d),t=document.querySelector('.fr-pagination__link[data-page="'+d+'"]'),fetch("#",{method:"POST",body:u}).then((e=>e.text().then((e=>{let u=document.querySelector("#signalements-result");u.innerHTML=e,u.querySelectorAll("tr").forEach((e=>{gauge=new Gauge(e.querySelector(".gauge-signalement")).setOptions(opts),gauge.set(e.getAttribute("data-score"))})),s.ariaCurrent=null,s.href="#",t.removeAttribute("href"),t.ariaCurrent="page",1!==d&&d!==c?r=[l,o,n,i]:1===d?(r=[n,i],a=[l,o]):d===c&&(r=[l,o],a=[n,i]),r.forEach((e=>{e.removeAttribute("aria-disabled"),e.href="#"})),a&&a.forEach((e=>{e.removeAttribute("href"),e.ariaDisabled="true"}))}))))}))})),document?.querySelectorAll('[name="bo-filter-form"]').forEach((e=>{e.addEventListener("change",(()=>{e.submit()}))})),document?.querySelectorAll("[data-fr-select-target]")?.forEach((e=>{let t=document?.querySelector("#"+e.getAttribute("data-fr-select-source")),r=document?.querySelector("#"+e.getAttribute("data-fr-select-target"));e.addEventListeners("click touchdown",(()=>{[...t.selectedOptions].map((e=>{let t,a=e.parentElement.getAttribute("data-select-group-id");r.querySelector('[data-select-group-id="'+a+'"]')?t=r.querySelector('[data-select-group-id="'+a+'"]'):(t=document.createElement("optgroup"),t.setAttribute("data-select-group-id",a),t.label=e.parentElement.label),t.append(e),r.append(t)}))}))})),document?.querySelector("#signalement-affectation-form-submit")?.addEventListeners("click touchdown",(e=>{e.preventDefault(),e.target.disabled=!0,e.target?.form?.querySelectorAll("option").forEach((e=>{e.selected=!0})),document?.querySelectorAll("#signalement-affectation-form-row,#signalement-affectation-loader-row").forEach((e=>{e.classList.toggle("fr-hidden")}));let t=new FormData(e.target.form);fetch(e.target.getAttribute("formaction"),{method:"POST",body:t}).then((e=>{e.ok&&window.location.reload(!0)})),console.log(e.target.form)})),document?.querySelectorAll(".fr-input--file-signalement").forEach((e=>{e.addEventListener("change",(e=>{e.target.form.submit()}))})),document?.querySelector("#partenaire_add_user,#situation_add_critere")?.addEventListeners("click touchdown",(e=>{let t,r,a,o,n;e.preventDefault(),"partenaire_add_user"===e.target.id?(t=document.importNode(document.querySelector("#partenaire_add_user_row").content,!0),r=document.querySelector("#partenaire_add_user_placeholder"),n="partenaire-row-user",a=r.querySelectorAll("."+n)?.length):(t=document.importNode(document.querySelector("#situation_add_critere_row").content,!0),r=document.querySelector("#situation_add_critere_placeholder"),n="situation-row-critere",a=r.querySelectorAll("."+n)?.length),o=document.createElement("div"),o.classList.add("fr-grid-row","fr-grid-row--gutters","fr-grid-row--middle","fr-background-alt--blue-france","fr-mb-5v",n),t.querySelectorAll("label,input,select,button,textarea").forEach((e=>{e.id=e?.id?.replaceAll("__ID__",a),e.name=e?.name?.replaceAll("__ID__",a),"LABEL"===e.tagName&&e.setAttribute("for",e.getAttribute("for").replaceAll("__ID__",a)),"BUTTON"===e.tagName&&e.addEventListeners("click touchdown",(e=>{e.target.closest("."+n).remove()}))})),o.appendChild(t),r.appendChild(o)})),document?.querySelectorAll("[data-delete]")?.forEach((e=>{e.addEventListeners("click touchdown",(t=>{let r;if(t.preventDefault(),t.target.classList.contains("partenaire-user-delete")?r=".partenaire-row-user":t.target.classList.contains("situation-critere-delete")?r=".situation-row-critere":t.target.classList.contains("signalement-file-delete")?r=".signalement-file-item":t.target.classList.contains("signalement-row-delete")?r=".signalement-row":t.target.classList.contains("partenaire-row-delete")&&(r=".partenaire-row"),confirm("Voulez-vous vraiment supprimer cet élément ?")){let t=new FormData;t.append("_token",e.getAttribute("data-token")),fetch(e.getAttribute("data-delete"),{method:"POST",body:t}).then((t=>{t.ok&&e.closest(r).remove()}))}}))})),document?.querySelector("#fr-bug-report-modal").addEventListeners("dsfr.disclose dsfr.conceal",(e=>{let t=e.target.querySelector('form[name="bug-report"]'),r=new FormData(t);"dsfr.disclose"===e.type?(e.target.querySelector("#bug-report-success").classList.add("fr-hidden"),t.classList.remove("fr-hidden"),e.target.querySelector("#bug-report-submit").disabled=!1,html2canvas(document.body).then((function(e){e.toBlob((e=>{r.append("capture",e,"capture.png")}))})),t.addEventListener("submit",(a=>{a.preventDefault(),a.stopPropagation(),e.target.querySelector("#bug-report-submit").disabled=!0,fetch(t.action,{method:"POST",body:r}).then((r=>r.text().then((r=>{console.log(r),t.classList.add("fr-hidden"),e.target.querySelector("#bug-report-success").classList.remove("fr-hidden")}))))}))):(r=null,e.target.querySelector("textarea").value="")})),document?.querySelectorAll(".fr-password-toggle")?.forEach((e=>{e.addEventListeners("click touchdown",(e=>{["fr-fi-eye-off-fill","fr-fi-eye-fill"].map((t=>{e.target.classList.toggle(t)}));let t=e.target.parentElement.querySelector('[name^="password"]');"text"!==t.type?t.type="text":t.type="password"}))})),document?.querySelector('form[name="login-creation-mdp-form"]')?.querySelectorAll('[name^="password"]').forEach((e=>{e.addEventListener("input",(()=>{let e=document?.querySelector('form[name="login-creation-mdp-form"] #login-password').value,t=document?.querySelector('form[name="login-creation-mdp-form"] #login-password-repeat').value,r=document?.querySelector('form[name="login-creation-mdp-form"] #password-match-error'),a=document?.querySelector('form[name="login-creation-mdp-form"] #submitter');e!==t?(document?.querySelector('form[name="login-creation-mdp-form"]').querySelectorAll(".fr-input-group").forEach((e=>{e.classList.add("fr-input-group--error"),e.querySelector(".fr-input").classList.add("fr-input--error")})),a.disabled=!0,r.classList.remove("fr-hidden")):(document?.querySelector('form[name="login-creation-mdp-form"]').querySelectorAll(".fr-input-group--error,.fr-input--error").forEach((e=>{["fr-input-group--error","fr-input--error"].map((t=>{e.classList.remove(t)}))})),r.classList.add("fr-hidden"),a.disabled=!1)}))}));