{% extends 'back/base_bo.html.twig' %}
{% set statuts = {
    1:'Nouveau',
    2:'En cours',
    3:'Non-valide',
    4:'En attente d\'info.',
    5:'A revoir',
    6:'Fermés'
} %}
{% block content %}
    <section class="fr-col-12 fr-col-md fr-background-alt--blue-france fr-p-5v">
        <div class="fr-grid-row fr-grid-row--gutters fr-grid-row--center">
            <div class="fr-col">
                <div class="fr-rounded fr-p-3v fr-border--bottom--orange fr-background--white">
                    <span class="fr-display-xs">{% if signalements.counts[1] is defined %}{{ signalements.counts[1].count }}{% else %}0{% endif %}</span><br>
                    <strong class="text-blue-france">Nouveaux</strong>
                </div>
            </div>
            <div class="fr-col">
                <div class="fr-rounded fr-p-3v fr-border--bottom--orange fr-background--white">
                    <span class="fr-display-xs">{% if signalements.counts[2] is defined %}{{ signalements.counts[2].count }}{% else %}0{% endif %}</span><br>
                    <strong class="text-blue-france">En cours</strong>
                </div>
            </div>
            <div class="fr-col">
                <div class="fr-rounded fr-p-3v fr-border--bottom--orange fr-background--white">
                    <span class="fr-display-xs">{% if signalements.counts[3] is defined %}{{ signalements.counts[3].count }}{% else %}0{% endif %}</span><br>
                    <strong class="text-blue-france">Non-valide</strong>
                </div>
            </div>
            <div class="fr-col">
                <div class="fr-rounded fr-p-3v fr-border--bottom--orange fr-background--white">
                    <span class="fr-display-xs">{% if signalements.counts[4] is defined %}{{ signalements.counts[4].count }}{% else %}0{% endif %}</span><br>
                    <strong class="text-blue-france">En attente d'info</strong>
                </div>
            </div>
            <div class="fr-col">
                <div class="fr-col fr-rounded fr-p-3v fr-border--bottom--orange fr-background--white">
                    <span class="fr-display-xs">{% if signalements.counts[5] is defined %}{{ signalements.counts[5].count }}{% else %}0{% endif %}</span><br>
                    <strong class="text-blue-france">A revoir</strong>
                </div>
            </div>
            <div class="fr-col">
                <div class="fr-col fr-rounded fr-p-3v fr-border--bottom--orange fr-background--white">
                    <span class="fr-display-xs">{% if signalements.counts[6] is defined %}{{ signalements.counts[6].count }}{% else %}0{% endif %}</span><br>
                    <strong class="text-blue-france">Fermés</strong>
                </div>
            </div>
        </div>
    </section>
    <section class="fr-col-12 fr-p-5v">
        <form action="#" name="bo-filter-form" method="POST"
              class="fr-grid-row fr-grid-row--gutters fr-grid-row--center">
            <div class="fr-col-md-4">
                <label class="fr-label" for="filter_ville"><strong>Filter par ville</strong></label>
                <select name="bo-filter-ville" id="filter_ville" class="fr-select">
                    <option value="all">TOUTES</option>
                    {% for ville in signalements.villes %}
                        <option value="{{ ville }}"
                                {% if filter.ville is same as(ville) %}selected{% endif %}>{{ ville|upper }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="fr-col-md-4">
                <label class="fr-label" for="filter_statut"><strong>Filter par statut</strong></label>
                <select name="bo-filter-statut" id="filter_statut" class="fr-select">
                    <option value="all">TOUS</option>
                    {% for statut,wording in statuts %}
                        <option value="{{ statut }}"
                                {% if filter.status is same as(""~statut~"") %}selected{% endif %}>{{ wording|upper }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="fr-col-md-4">
                <label class="fr-label" for="header-search-input"><strong>Rechercher</strong></label>
                <div class="fr-search-bar fr-mt-2v" id="header-search">
                    <input class="fr-input" placeholder="Rechercher" type="search" id="header-search-input"
                           name="search" value="">
                    <button class="fr-btn" title="Rechercher">
                        Rechercher
                    </button>
                </div>
            </div>
        </form>
        <div class="fr-col-12 fr-text--right fr-pt-0">
            <a href="{{ path('back_index') }}" class="fr-link fr-link--icon-left fr-fi-close-circle-line">Réinitialiser
                les résultats</a>
        </div>
    </section>
    <section class="fr-col-12 fr-table fr-table--bordered">
        <table class="fr-display-inline-table sortable">
            <thead class="fr-background-alt--blue-france">
            <tr>
                <th>#Ref.</th>
                <th>Date</th>
                {# <th>Situation(s)</th> #}
                {# <th>Alert.</th> #}
                {# <th>Criticité</th> #}
                <th>Criticité</th>
                <th>Occupant</th>
                <th>Adresse</th>
                <th>Affectation</th>
                <th>Etat</th>
                <th class="fr-text--right ">Actions</th>
            </tr>
            </thead>
            <tbody id="signalements-result">
            {% include 'back/table_result.html.twig' %}
            </tbody>
        </table>
        <div class="fr-grid-row fr-mt-2v fr-grid-row--center">
            <nav role="navigation" class="fr-pagination" aria-label="Pagination">
                <ul class="fr-pagination__list">
                    <li>
                        <a class="fr-pagination__link fr-pagination__link--first" aria-disabled="true">
                            Première page
                        </a>
                    </li>
                    <li>
                        <a class="fr-pagination__link fr-pagination__link--prev fr-pagination__link--lg-label"
                           aria-disabled="true" role="link">
                            Page précédente
                        </a>
                    </li>
                    <li>
                        <a class="fr-pagination__link" aria-current="page" title="Page 1" data-page="1">
                            1
                        </a>
                    </li>
                    {% if signalements.pages > 1 %}
                        {% for i in 2..signalements.pages %}
                            <li>
                                <a class="fr-pagination__link" href="#" title="Page {{ i }}" data-page="{{ i }}">
                                    {{ i }}
                                </a>
                            </li>
                        {% endfor %}
                    {% endif %}
                    <li>
                        <a class="fr-pagination__link fr-pagination__link--next fr-pagination__link--lg-label"
                           {% if signalements.pages > 1 %}href="#" {% else %}aria-disabled="true" {% endif %}>
                            Page suivante
                        </a>
                    </li>
                    <li>
                        <a class="fr-pagination__link fr-pagination__link--last" {% if signalements.pages > 1 %}href="#"
                           {% else %}aria-disabled="true" {% endif %} data-page="{{ signalements.pages }}">
                            Dernière page
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </section>
{% endblock %}
{% block javascripts %}
    <script>
        opts.pointer = {
            length: 0.49, // // Relative to gauge radius
            strokeWidth: 0.1, // The thickness
            color: '#000000' // Fill color
        }
        {% for signalement in signalements.list %}
        gauge = new Gauge(document.getElementById('gauge-signalement-{{ signalement.id }}')).setOptions(opts); // create sexy gauge!
        gauge.set({{ signalement.scoreCreation }}); // set actual value
        {% endfor %}
        gauge.maxValue = 100; // set max gauge value
        gauge.setMinValue(0);  // Prefer setter over gauge.minValue = 0
        gauge.animationSpeed = 100; // set animation speed (32 is default value)
    </script>
{% endblock %}